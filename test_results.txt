  Determining projects to restore...
  All projects are up-to-date for restore.
  COA.Mcp.Protocol -> C:\source\COA MCP Framework\src\COA.Mcp.Protocol\bin\Debug\net9.0\COA.Mcp.Protocol.dll
  COA.Mcp.Framework -> C:\source\COA MCP Framework\src\COA.Mcp.Framework\bin\Debug\net9.0\COA.Mcp.Framework.dll
  COA.Mcp.Protocol.Tests -> C:\source\COA MCP Framework\tests\COA.Mcp.Protocol.Tests\bin\Debug\net9.0\COA.Mcp.Protocol.Tests.dll
Test run for C:\source\COA MCP Framework\tests\COA.Mcp.Protocol.Tests\bin\Debug\net9.0\COA.Mcp.Protocol.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (x64)

  COA.Mcp.Client -> C:\source\COA MCP Framework\src\COA.Mcp.Client\bin\Debug\net9.0\COA.Mcp.Client.dll
  COA.Mcp.Framework.TokenOptimization -> C:\source\COA MCP Framework\src\COA.Mcp.Framework.TokenOptimization\bin\Debug\net9.0\COA.Mcp.Framework.TokenOptimization.dll
  COA.Mcp.Framework.Tests -> C:\source\COA MCP Framework\tests\COA.Mcp.Framework.Tests\bin\Debug\net9.0\COA.Mcp.Framework.Tests.dll
Starting test execution, please wait...
Test run for C:\source\COA MCP Framework\tests\COA.Mcp.Framework.Tests\bin\Debug\net9.0\COA.Mcp.Framework.Tests.dll (.NETCoreApp,Version=v9.0)
A total of 1 test files matched the specified pattern.
VSTest version 17.14.1 (x64)

Starting test execution, please wait...
  COA.Mcp.Framework.Testing -> C:\source\COA MCP Framework\src\COA.Mcp.Framework.Testing\bin\Debug\net9.0\COA.Mcp.Framework.Testing.dll
A total of 1 test files matched the specified pattern.
  COA.Mcp.Framework.TokenOptimization.Tests -> C:\source\COA MCP Framework\tests\COA.Mcp.Framework.TokenOptimization.Tests\bin\Debug\net9.0\COA.Mcp.Framework.TokenOptimization.Tests.dll
Test run for C:\source\COA MCP Framework\tests\COA.Mcp.Framework.TokenOptimization.Tests\bin\Debug\net9.0\COA.Mcp.Framework.TokenOptimization.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (x64)

  COA.Mcp.Framework.Testing.Tests -> C:\source\COA MCP Framework\tests\COA.Mcp.Framework.Testing.Tests\bin\Debug\net9.0\COA.Mcp.Framework.Testing.Tests.dll
Starting test execution, please wait...
Test run for C:\source\COA MCP Framework\tests\COA.Mcp.Framework.Testing.Tests\bin\Debug\net9.0\COA.Mcp.Framework.Testing.Tests.dll (.NETCoreApp,Version=v9.0)
  COA.Mcp.Client.Tests -> C:\source\COA MCP Framework\tests\COA.Mcp.Client.Tests\bin\Debug\net9.0\COA.Mcp.Client.Tests.dll
A total of 1 test files matched the specified pattern.
Test run for C:\source\COA MCP Framework\tests\COA.Mcp.Client.Tests\bin\Debug\net9.0\COA.Mcp.Client.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.14.1 (x64)

VSTest version 17.14.1 (x64)

Starting test execution, please wait...
Starting test execution, please wait...
A total of 1 test files matched the specified pattern.
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:   106, Skipped:     0, Total:   106, Duration: 299 ms - COA.Mcp.Protocol.Tests.dll (net9.0)
  Skipped ExecuteAsync_WhenCancelled_ThrowsOperationCanceledException [< 1 ms]

Passed!  - Failed:     0, Passed:    44, Skipped:     0, Total:    44, Duration: 362 ms - COA.Mcp.Framework.TokenOptimization.Tests.dll (net9.0)
  Skipped AddMcpToolsFromAssembly_RegistersAllToolsInAssembly [< 1 ms]
  Skipped AddMcpToolsFromAssembly_RegistersToolsByInterface [< 1 ms]
  Skipped AddMcpToolsFromAssembly_SkipsAbstractClasses [< 1 ms]
  Skipped FullIntegration_RegisterAndResolveTools [< 1 ms]
  Skipped EnsureServiceRunningAsync_WithValidConfig_StartsService [< 1 ms]
  Skipped Memory_LeakDetection [< 1 ms]
  Failed MemoryUsage_UnboundedGrowth_DemonstratesActualLeak [51 ms]
  Error Message:
     CRITICAL MEMORY LEAK: Cache memory grew to 102400 bytes (growth: 102400 bytes) but should be capped at 51200. Root cause: Line 26 ConcurrentDictionary<string, TypeVerificationState> has no eviction policy!
Assert.That(finalStats.MemoryUsageBytes, Is.LessThan(expectedMaxMemory))
  Expected: less than 51200
  But was:  102400

  Stack Trace:
     at COA.Mcp.Framework.Tests.Services.VerificationStateManagerTests.MemoryUsage_UnboundedGrowth_DemonstratesActualLeak() in C:\source\COA MCP Framework\tests\COA.Mcp.Framework.Tests\Services\VerificationStateManagerTests.cs:line 558
   at NUnit.Framework.Internal.TaskAwaitAdapter.GenericAdapter`1.GetResult()
   at NUnit.Framework.Internal.AsyncToSyncAdapter.Await[TResult](TestExecutionContext context, Func`1 invoke)
   at NUnit.Framework.Internal.AsyncToSyncAdapter.Await(TestExecutionContext context, Func`1 invoke)
   at NUnit.Framework.Internal.Commands.TestMethodCommand.RunTestMethod(TestExecutionContext context)
   at NUnit.Framework.Internal.Commands.TestMethodCommand.Execute(TestExecutionContext context)
   at NUnit.Framework.Internal.Commands.BeforeAndAfterTestCommand.<>c__DisplayClass1_0.<Execute>b__0()
   at NUnit.Framework.Internal.Commands.DelegatingTestCommand.RunTestMethodInThreadAbortSafeZone(TestExecutionContext context, Action action)

1)    at COA.Mcp.Framework.Tests.Services.VerificationStateManagerTests.MemoryUsage_UnboundedGrowth_DemonstratesActualLeak() in C:\source\COA MCP Framework\tests\COA.Mcp.Framework.Tests\Services\VerificationStateManagerTests.cs:line 558
   at System.Runtime.CompilerServices.AsyncMethodBuilderCore.Start[TStateMachine](TStateMachine& stateMachine)
   at COA.Mcp.Framework.Tests.Services.VerificationStateManagerTests.MemoryUsage_UnboundedGrowth_DemonstratesActualLeak()



Passed!  - Failed:     0, Passed:    50, Skipped:     0, Total:    50, Duration: 10 s - COA.Mcp.Client.Tests.dll (net9.0)

Passed!  - Failed:     0, Passed:    22, Skipped:     1, Total:    23, Duration: 15 s - COA.Mcp.Framework.Testing.Tests.dll (net9.0)

Failed!  - Failed:     1, Passed:   424, Skipped:     6, Total:   431, Duration: 1 m 21 s - COA.Mcp.Framework.Tests.dll (net9.0)
